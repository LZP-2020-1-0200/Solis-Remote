
SOLISresponse$=""
SaveDir$=""
stagePortNumber=8
//returns "" if read line has to be passed to stage,
//otherwise returns the response string
function ~HandleSolisCommands(line$)
	spaceIndex=instr(line$," ")
	command$=line$
	args$=""
	if (spaceIndex!=0) then
		command$=left$(line$,spaceIndex-1)
		args$=mid$(line$,spaceIndex+1, len(line$)-spaceIndex)
	endif
	
	HandleSolisCommands=1		
	SOLISresponse$=""
	if (strcomp(command$, "PING")==0) then
		HandleSolisCommands=0
		SOLISresponse$="PING"
		print("ping received...")
	endif
	if (strcomp(command$,"RUN")==0) then
		HandleSolisCommands=0
		SOLISresponse$="OK"
		run()
		fileName$=""
		if (spaceIndex!=0) then
			fileName$=SaveDir$+"\"+args$
		else
			fileName$=SaveDir$+"\"+str$(time())+".asc"
		endif

		SaveAsciiXY(#0,fileName$,2,1)
		print(fileName$)
		closeWindow(#0)
	endif
	if (strcomp(command$,"SDIR")==0) then
		HandleSolisCommands=0
		SaveDir$=args$
		SOLISresponse$="OK"
	endif
	
	
return

//comread(3,stageResponse$)
while(1)
	//reads the input
	print("waiting for input...")
	comread(1,pyInput$)
	print("received...")
	print(pyInput$)
	if (~HandleSolisCommands(pyInput$)) then
		print("forwarding to stage...")
		comwrite(stagePortNumber,pyInput$)
		comread(stagePortNumber,stageResponse$)
		print(stageResponse$)
		comwrite(1,stageResponse$)
	else
		print("capturing")
		comwrite(1,SOLISresponse$)
	endif
	
	
wend
